<html>
  <head>
    <title>NIMpossible</title>
  </head>
  
<body>

<h1>NIMpossible</h1>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // global variables
    var deviceID = "0a10aced202194944a067a68";
    var accessToken = "464786ca8d3bb33534cfd6ab99305aa834cf4146";
    var baseURL = "https://api.particle.io/v1/devices/"
  </script>

Current Gamestate: 
<br> Row 1: <span id="numSticks_1"></span> sticks. 
<br> Row 2: <span id="numSticks_2"></span> sticks.
<br> Row 3: <span id="numSticks_3"></span> sticks.
<br> Row 4: <span id="numSticks_4"></span> sticks.
<br>
<br>

<div id="message"></div>
<br>

<div style="display: none">
  <span id="notTurn"></span>
  <span id="gameWon"></span>
  <span id="gameActive"></span>
</div>

 <form id="stickTake">
    <input type="radio" name="mode" value="1">Row 1.<br>
    <input type="radio" name="mode" value="2">Row 2.<br>
    <input type="radio" name="mode" value="3">Row 3.<br>
    <input type="radio" name="mode" value="4">Row 4.<br>
    <input id="removeStick" type="submit" value="Remove Stick">
  </form>

  <button id="turnEnd" onclick="end()">End Turn</button>
  <button id="quitOut" onclick="exit()">Forfeit</button>
  <br>
  <br>
  <button id="startGame" onclick="reset()" value="false">New Game</button>

<script> //remove stick call
    $("#stickTake").submit(function(event) {
        event.preventDefault();
        var functionName = "takeStick"; // local variable functionName
        $.ajax({
            url: 'https://api.particle.io/v1/devices/'+ deviceID +'/' + functionName,
            method: "POST",
            headers: { "Authorization": "Bearer " + accessToken },
            data: { arg: $("input[name='mode']:checked").val() },
            success: () => alert("Message Sent!")

        });
        pullData(); 
    });
</script>

<script type="text/javascript"> //end turn call
  function end(objButton) {
    event.preventDefault();
        var functionName = "endTurn"; // local variable functionName
        $.ajax({
            url: 'https://api.particle.io/v1/devices/'+ deviceID +'/' + functionName,
            method: "POST",
            headers: { "Authorization": "Bearer " + accessToken },
            data: { arg: $("input[name='mode']:checked").val() },
            success: () => alert("Message Sent!")

        });
        pullData(); 
  }
</script>

<script type="text/javascript"> //forfeit call
  function exit(objButton) {
    event.preventDefault();
        var functionName = "quit"; // local variable functionName
        $.ajax({
            url: 'https://api.particle.io/v1/devices/'+ deviceID +'/' + functionName,
            method: "POST",
            headers: { "Authorization": "Bearer " + accessToken },
            data: { arg: $("input[name='mode']:checked").val() },
            success: () => alert("Message Sent!")

        });
        pullData(); 
  }
</script>

<script type="text/javascript"> //new game call
  function reset(objButton) {
    event.preventDefault();
        var functionName = "startGame"; // local variable functionName
        $.ajax({
            url: 'https://api.particle.io/v1/devices/'+ deviceID +'/' + functionName,
            method: "POST",
            headers: { "Authorization": "Bearer " + accessToken },
            data: { arg: $("input[name='mode']:checked").val() },
            success: () => alert("Message Sent!")

        });
        pullData(); 
  }
</script>

<script type="text/javascript"> //update state variables 
  var alertSent = false; 

  async function pullData() {
      var varName = "numSticks1"; //row1Sticks
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("numSticks_1").innerText = resp.result;},
      });


      var varName = "numSticks2";  //row2Sticks
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("numSticks_2").innerText = resp.result;},
      });

      var varName = "numSticks3";  //row3Sticks
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("numSticks_3").innerText = resp.result;},
      });

      var varName = "numSticks4";  //row4Sticks
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("numSticks_4").innerText = resp.result;},
      });

      var varName = "otherTurn";  //photonTurn
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("notTurn").innerText = resp.result;},
      });

      var varName = "winner";  //gameWon
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("gameWon").innerText = resp.result;},
      });

      var varName = "currentGame";  //playAgain
      $.ajax({
          url: baseURL + deviceID + '/' + varName,
          headers: {'Authorization': 'Bearer ' + accessToken},
          method: 'GET',
success: function(resp) {
              document.getElementById("gameActive").innerText = resp.result;},
      });

      //disable buttons
      var disableButtons = document.getElementById("notTurn").innerText == "true"; 
      document.getElementById("removeStick").disabled = disableButtons; 
      document.getElementById("turnEnd").disabled = disableButtons;
      document.getElementById("quitOut").disabled = disableButtons;

      var newGameBlocked = document.getElementById("gameActive").innerText == "true";
      document.getElementById("startGame").disabled = newGameBlocked; 

      //update turn indicator 
      if(document.getElementById("gameActive").innerText == "false")
      {
        document.getElementById("message").textContent = "Press new game, to start a game";
      }
      else
      {
        if(document.getElementById("notTurn").innerText == "true") 
        {
          document.getElementById("message").textContent = "Wait your turn!"; 
        } 
        else
        {
          document.getElementById("message").textContent = "Go! Go! Go!"; 
        }
      }

      //display win/loss messages
      if(document.getElementById("gameWon").innerText == "true" && !alertSent)
      {
        if(document.getElementById("notTurn").innerText == "true")
        {
          alert("You win! Way to go!")
        }
        else
        {
          alert("You lose! Press new game to try again.")
        }
        alertSent = true; 
      }
      else if(document.getElementById("gameWon").innerText != "true")
      {
        alertSent = false; 
      }
  }
</script>

<script>
  pullData();
  setInterval(pullData, 1000); 
</script>

</body>
</html>